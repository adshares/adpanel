<section class="preferences">
  <div
    class="
      dwmth-box
      dwmth-box--large"
  >
    <div class="col">
      <h2
        class="
          dwmth-heading
          dwmth-heading--primary"
      >
        Email & password
      </h2>
      <p
        class="
          dwmth-copy
          dwmth-copy--large"
      >
        Here you can change your email and password.
      </p>

      <form
        [formGroup]="changeEmailForm"
        (ngSubmit)="onChangeEmail()"
        class="dwmth-form"
        data-test="settings-change-email-form"
      >
        <div
          class="
            row
            align-start
            change-form"
        >
          <div class="dwmth-form-input__box">
            <label
              for="email"
              class="dwmth-form-label"
            >
              Email address
            </label>
            <input
              id="email"
              class="dwmth-form-input"
              type="email"
              name="email"
              formControlName="email"
              data-test="settings-change-email-form-email"
              [placeholder]="user.email"
            >
            <span
              class="input-valid"
              *ngIf="changeEmailForm.get('email').valid"
            ></span>
            <span
              class="error-msg"
              *ngIf="changeEmailForm.hasError('email', ['email']) && changeEmailFormSubmitted"
            >
              Invalid email!
            </span>
            <span
              class="error-msg"
              *ngIf="changeEmailForm.hasError('required', ['email']) && changeEmailFormSubmitted"
            >
              Email required!
            </span>
            <span
              class="error-msg"
              *ngIf="errorEmailChange"
            >
              {{errorEmailChange}}
            </span>
          </div>
          <button
            class="
              dwmth-btn
              dwmth-btn--blue"
            data-test="settings-change-email-form-submit"
          >
            Change email
          </button>
        </div>
      </form>

      <form
        [formGroup]="changePasswordForm"
        (ngSubmit)="onChangePassword()"
        class="dwmth-form"
        data-test="settings-change-password-form"
      >
        <div
          class="
            row
            align-start
            change-form"
        >
          <div class="row">
            <div class="dwmth-form-input__box">
              <label
                for="currentPassword"
                class="dwmth-form-label"
              >
                Current Password
              </label>
              <input
                id="currentPassword"
                class="dwmth-form-input"
                type="password"
                name="currentPassword"
                formControlName="currentPassword"
                data-test="settings-change-password-form-current-password"
              >
              <span
                      class="error-msg"
                      *ngIf="errorsPasswordChange && ObjectKeys(errorsPasswordChange).length > 0"
              >
                <span *ngFor="let errorForm of ObjectKeys(errorsPasswordChange)">{{ errorsPasswordChange[errorForm] }}</span>
              </span>
              <span
                class="error-msg"
                *ngIf="
                  changePasswordForm.hasError('required', ['currentPassword']) &&
                  changePasswordFormSubmitted"
              >
                Current password required!
              </span>
            </div>
            <div class="dwmth-form-input__box">
              <label
                for="newPassword"
                class="dwmth-form-label"
              >
                New password
              </label>
              <input
                id="newPassword"
                class="dwmth-form-input"
                type="password"
                name="newPassword"
                formControlName="newPassword"
                data-test="settings-change-password-form-new-password"
              >
              <span
                class="input-valid"
                *ngIf="changePasswordForm.get('newPassword').valid"
              ></span>
              <span
                class="error-msg"
                *ngIf="
                  changePasswordForm.hasError('required', ['newPassword']) &&
                  changePasswordFormSubmitted"
              >
                New password required
              </span>
              <span
                class="error-msg"
                *ngIf="changePasswordForm.hasError('minlength', ['newPassword']) &&
                       changePasswordForm.get('newPassword').touched">
                Minimum 8 signs required!
              </span>
            </div>

            <div class="dwmth-form-input__box">
              <label
                for="newPasswordConfirm"
                class="dwmth-form-label"
              >
                Confirm password
              </label>
              <input
                id="newPasswordConfirm"
                class="dwmth-form-input"
                type="password"
                name="newPasswordConfirm"
                [formControl]="newPasswordConfirm"
                data-test="settings-change-password-form-new-password-confirm-password"
              >
              <span
                class="input-valid"
                *ngIf="
                  newPasswordConfirm.value === changePasswordForm.get('newPassword').value &&
                  changePasswordForm.get('newPassword').valid"
              ></span>
              <span
                class="error-msg"
                *ngIf="
                  newPasswordConfirm.value !== changePasswordForm.get('newPassword').value &&
                  newPasswordConfirm.touched &&
                  changePasswordForm.get('newPassword').touched"
              >
                Passwords don't match!
              </span>
            </div>
          </div>
          <button
            class="
              dwmth-btn
              dwmth-btn--blue"
            data-test="settings-change-password-form-submit"
          >
            Change password
          </button>
        </div>
      </form>
    </div>
  </div>
</section>
