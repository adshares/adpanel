<section
  class="
    homepage-view
    campaign-edit-conversion"
>
  <div class="text-center">
    <h1
      class="
        dwmth-heading
        dwmth-heading--primary"
    >
      Conversion
    </h1>
  </div>

  <div
    class="
        dwmth-box
        dwmth-box--large"
  >
    <mat-checkbox
      id="conversion-is-active-checkbox"
      name="isActive"
      [(ngModel)]="isConversionActive"
      data-test="advertiser-conversion-is-active-checkbox"
    >
      Conversion is active
    </mat-checkbox>

    <div
      *ngIf="isConversionActive"
    >
      <button
        type="button"
        class="dwmth-btn
               dwmth-btn--white
               dwmth-blue"
        (click)="addConversionEmpty(MODE_BASIC)"
        data-test="advertiser-conversion-mode-basic-button"
      >
        Add basic
      </button>

      <button
        type="button"
        class="dwmth-btn
               dwmth-btn--white
               dwmth-blue"
        (click)="addConversionEmpty(MODE_ADVANCED)"
        data-test="advertiser-conversion-mode-advanced-button"
      >
        Add advanced
      </button>


      <button
        type="button"
        class="campaign-edit-conversion__btn"
        title="Click to add conversion"
        (click)="addConversionEmpty(MODE_BASIC)"
      >
        <mat-icon>add_circle_outline</mat-icon>
      </button>

      <mat-checkbox
        id="conversion-is-click-conversion-checkbox"
        name="isActive"
        [(ngModel)]="isClickConversion"
        data-test="advertiser-conversion-is-active-checkbox"
      >
        Enable click conversion
      </mat-checkbox>

      <table>
        <tr>
          <th class="col-xs-2">Name</th>
          <th class="col-xs-2">Type</th>
          <th class="col-xs-2">Value</th>
          <th class="col-xs-2">Maximal budget</th>
          <th class="col-xs-3"></th>
          <th class="col-xs-1"></th>
        </tr>
      </table>

      <div
        class="dwmth-box dwmth-box--no-padding"
      >
        <form
          *ngFor="let conversionItemForm of conversionItemForms; let conversionItemFormIndex = index"
          [formGroup]="conversionItemForm"
          data-test="advertiser-conversion-item"
        >
          <tr
            class="row
                   dwmth-box
                   align-center
                   justify-between
                   dwmth-copy"
          >
            <td
              class="
                col-xs-2
                row
                align-center"
            >
              <input
                class="dwmth-form-input"
                formControlName="name"
                data-test="advertiser-conversion-item-name"
              >
              <span
                class="error-msg"
                *ngIf="!conversionItemForm.get('name').valid && validateForm"
              >
                Cannot be empty.
              </span>
            </td>
            <td
              class="
                col-xs-2
                row
                align-center"
            >
              <input
                class="dwmth-form-input"
                formControlName="type"
                data-test="advertiser-conversion-item-type"
              >
            </td>
            <td
              class="
                col-xs-2
                row
                align-center"
            >
              <input
                class="dwmth-form-input"
                formControlName="value"
                data-test="advertiser-conversion-item-value"
              >
              <span
                class="error-msg"
                *ngIf="!conversionItemForm.get('isAdvanced').value && !conversionItemForm.get('name').valid && validateForm"
              >
                Must be greater than zero.
              </span>
            </td>
            <td
              class="
                col-xs-2
                row
                align-center"
            >
              <input
                class="dwmth-form-input"
                formControlName="limit"
                data-test="advertiser-conversion-item-limit"
              >
            </td>
            <td
              class="
                col-xs-3
                row
                align-center"
            >
              <mat-checkbox
                formControlName="isInBudget"
                data-test="advertiser-conversion-item-is-in-budget"
              >
                In campaign budget
              </mat-checkbox>
            </td>
            <td
              class="
                col-xs-1
                row
                align-center"
            >
              <button
                class="campaign-edit-conversion__btn"
                title="Click to remove conversion"
                (click)="deleteConversion(conversionItemFormIndex)"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>
        </form>
      </div>

    </div>
  </div>


  <div
    class="dwmth-box
           dwmth-box--large
           row
           justify-between"
  >
    <button
      type="button"
      class="dwmth-btn
             dwmth-btn--white
             dwmth-blue"
      (click)="onStepBack()"
      [disabled]="submitted"
      data-test="advertiser-navigate-to-dashboard"
    >
      Back
    </button>

    <button
      class="dwmth-btn dwmth-btn--wide dwmth-btn--blue"
      (click)="updateCampaignConversion()"
      data-test="advertiser-edit-campaign-save-and-continue"
    >
      <span *ngIf="!submitted; else loading">
        Update
      </span>
      <ng-template #loading>
        <mat-spinner [diameter]="20" [strokeWidth]="2" color="accent"></mat-spinner>
      </ng-template>
    </button>
  </div>
</section>
