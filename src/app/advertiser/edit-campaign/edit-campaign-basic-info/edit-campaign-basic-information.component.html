<section
  *ngIf="campaignBasicInfoForm"
  class="
    homepage-view
    campaign-edit-basic-information"
>
  <div class="text-center">
    <h1
      class="
        dwmth-heading
        dwmth-heading--primary"
    >
      Basic information
    </h1>
  </div>

  <form
    [formGroup]="campaignBasicInfoForm"
    (ngSubmit)="onSubmit()"
    class="dwmth-form"
    data-test="advertiser-edit-campaign-basic-information-form"
  >
    <div
      class="
        dwmth-box
        dwmth-box--large"
    >
      <div class="dwmth-form-input__box">
        <label
          for="campaignName"
          class="dwmth-form-label"
        >
          Campaign name
        </label>
        <input
          id="campaignName"
          class="
            dwmth-form-input
            dwmth-form-input--full"
          name="campaignName"
          formControlName="name"
          data-test="advertiser-edit-campaign-basic-information-form-name"
        >
        <span
          *ngIf="campaignBasicInfoForm.get('name').valid"
          class="input-valid"
        ></span>
        <span
          class="error-msg"
          *ngIf="
            campaignBasicInfoForm.hasError('required', ['name']) &&
            campaignBasicInformationSubmitted"
        >
          Campaign name required!
        </span>
      </div>

      <div class="dwmth-form-input__box">
        <label
          for="campaignTargetURL"
          class="dwmth-form-label"
        >
          Target URL
        </label>
        <input
          id="campaignTargetURL"
          class="
            dwmth-form-input
            dwmth-form-input--full"
          type="text"
          name="campaignTargetURL"
          formControlName="targetUrl"
          data-test="advertiser-edit-campaign-basic-information-form-target-url"
        >
        <span
          *ngIf="
            campaignBasicInfoForm.get('targetUrl').valid"
          class="input-valid"></span>
        <span
          class="error-msg"
          *ngIf="!campaignBasicInfoForm.get('targetUrl').valid && campaignBasicInformationSubmitted"
        >
          Please provide a valid URL.
        </span>
      </div>

      <app-placeholders-accordion></app-placeholders-accordion>

      <div class="dwmth-form-input__box">
        <div
          class="
            row
            no-gutters"
        >

          <div
            class="
              col
              col-xs-5"
          >
            <div class="relative">
              <label
                for="campaign-budget-per-day"
                class="dwmth-form-label"
              >
                Budget ({{currencyCode}}/day)
              </label>
              <input
                id="campaign-budget-per-day"
                class="
                  dwmth-form-input
                  input-budget"
                type="number"
                step="0.01"
                name="campaignBudgetPerDay"
                [formControl]="budgetPerDay"
                (focus)="onFocus('campaign-budget-per-day')"
                data-test="advertiser-edit-campaign-basic-information-form-budget-per-day"
              >
              <span
                *ngIf="campaignBasicInfoForm.get('budget').valid"
                class="input-valid"
              ></span>
            </div>
            <span
              class="error-msg"
              *ngIf="
                budgetPerDay.hasError('required') &&
                campaignBasicInformationSubmitted"
            >
              Budget required
            </span>
            <span
              class="error-msg"
              *ngIf="
                budgetPerDay.hasError('min') &&
                campaignBasicInformationSubmitted"
            >
              Allowed minimum is {{this.campaignsConfig.minBudget|budgetPerDay|formatMoney:2:''}}
            </span>
          </div>
          <!-- divider -->
          <div
            class="
              col
              col-xs-2"
          >
          </div>
          <div
            class="
              col
              col-xs-5"
          >
            <div class="relative">
              <label
                for="campaign-budget"
                class="dwmth-form-label"
              >
                Budget ({{currencyCode}}/hour)
              </label>
              <input
                id="campaign-budget"
                class="
                  dwmth-form-input
                  input-budget"
                type="number"
                step="0.0001"
                name="campaignBudget"
                formControlName="budget"
                (focus)="onFocus('campaign-budget')"
                data-test="advertiser-edit-campaign-basic-information-form-budget"
              >
              <span
                *ngIf="campaignBasicInfoForm.get('budget').valid"
                class="input-valid"
              ></span>
            </div>
            <span
              class="error-msg"
              *ngIf="
                campaignBasicInfoForm.hasError('required', ['budget']) &&
                campaignBasicInformationSubmitted"
            >
              Budget required
            </span>
            <span
              class="error-msg"
              *ngIf="
                campaignBasicInfoForm.hasError('min', ['budget']) &&
                campaignBasicInformationSubmitted"
            >
              Allowed minimum is {{this.campaignsConfig.minBudget|formatMoney:2:''}}
            </span>
          </div>
        </div>
      </div>

      <div class="dwmth-form-input__box">
        <div
          class="
            row
            justify-between
            no-gutters"
        >
          <div
            class="
              col
              col-xs-5
              col-xxl-3"
          >
            <label class="dwmth-form-label">Start date</label>
            <mat-form-field
              class="
                dwmth-form-input
                dwmth-form-input--narrow
                row"
            >
              <img
                [owlDateTimeTrigger]="dateStartPicker"
                src="/assets/images/calendar.svg"
                alt="Add new icon"
                class="dwmth-icon">
              <input
                class="
                dwmth-form-input
                dwmth-form-input--narrow
                dwmth-form-input--date
                row"
                [owlDateTime]="dateStartPicker"
                [formControl]="dateStart"
                [owlDateTimeTrigger]="dateStartPicker"
                [min]="today"
                matInput
                type="text"
                required
                data-test="advertiser-edit-campaign-basic-information-form-start-date"
              >
              <owl-date-time #dateStartPicker></owl-date-time>
            </mat-form-field>

            <span
              class="error-msg"
              *ngIf="dateStart.hasError('required') && campaignBasicInformationSubmitted"
            >
              Start date required
            </span>
          </div>
          <div
            class="
              col
              col-xs-5
              col-xxl-3"
          >
            <label class="dwmth-form-label">
              End date (optional)
            </label>
            <mat-form-field class="dwmth-form-input
                                   dwmth-form-input--narrow
                                   row">
              <img [owlDateTimeTrigger]="dateEndPicker"
                   src="/assets/images/calendar.svg"
                   alt="Add new icon"
                   class="dwmth-icon">
              <input class="dwmth-form-input
                       dwmth-form-input--narrow
                       dwmth-form-input--date
                       row"
                     [owlDateTime]="dateEndPicker"
                     [owlDateTimeTrigger]="dateEndPicker"
                     matInput
                     [min]="dateStart.value"
                     [formControl]="dateEnd"
                     data-test="advertiser-edit-campaign-basic-information-form-end-date"
              >
              <owl-date-time #dateEndPicker></owl-date-time>
            </mat-form-field>
          </div>
        </div>
      </div>

      <mat-accordion>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title class="dwmth-form-label">
              Advanced
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="dwmth-form-input__box">
            <div class="row no-gutters">
              <label class="dwmth-form-label">
                Max CPM ({{currencyCode}})
              </label>
              <mat-checkbox
                [checked]="isAutoCpm"
                (change)="changeAutoCpm($event.checked)"
                data-test="advertiser-edit-campaign-basic-information-form-auto-max-cpm"
              >
                auto
              </mat-checkbox>
            </div>
            <div
                    *ngIf="!isAutoCpm"
                    class="row no-gutters"
            >
              <div class="col">
                <div class="col relative">
                  <input
                          id="campaign-max-cpm"
                          class="dwmth-form-input input-budget"
                          type="number"
                          step="0.01"
                          name="campaignMaxCpm"
                          formControlName="maxCpm"
                          data-test="advertiser-edit-campaign-basic-information-form-max-cpm"
                  >
                  <span
                          *ngIf="campaignBasicInfoForm.get('maxCpm').valid"
                          class="input-valid"
                  ></span>
                </div>
                <span
                        class="error-msg"
                        *ngIf="
                        campaignBasicInfoForm.hasError('min', ['maxCpm']) &&
                        campaignBasicInformationSubmitted"
                >
                  Allowed minimum is {{this.campaignsConfig.minCpm|formatMoney:2:''}}
                </span>
              </div>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>

    </div>
    <div
      class="dwmth-box
             dwmth-box--large
             row
             justify-between">
      <button type="button"
              class="dwmth-btn
                     dwmth-btn--white
                     dwmth-blue"
              (click)="onStepBack()"
              [disabled]="campaignBasicInformationSubmitted || changesSaved"
              data-test="advertiser-navigate-to-dashboard">
        {{ createCampaignMode ? 'Back to dashboard' : 'Back' }}
      </button>
      <button class="dwmth-btn dwmth-btn--wide dwmth-btn--blue"
              data-test="advertiser-edit-campaign-save-and-continue">
        <span *ngIf="!changesSaved; else loading">
        {{ createCampaignMode ? 'Save & continue' : 'Update' }}
        </span>
        <ng-template #loading>
          <mat-spinner [diameter]="20" [strokeWidth]="2" color="accent"></mat-spinner>
        </ng-template>
      </button>
    </div>
  </form>
</section>

